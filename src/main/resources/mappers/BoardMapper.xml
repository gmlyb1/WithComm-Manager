<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.soft.dao.BoardDAO">


	<!-- 글 목록 -->
	<select id="BoardList" resultType="boardVO" parameterType="boardVO">
		select
		 *
		from
		 tbl_board
	</select>
	
	<select id="HomeBoardList" resultType="boardVO" parameterType="boardVO">
		select * 
		from tbl_board LIMIT 5
	</select>
	
	<update id="replyCount" parameterType="int">
	update tbl_baord set board_reply_hit = board_reply_hit + #{amount} where board_no = #{board_no}
	</update>
	
	<!--  글 작성 -->
	<insert id="insertBoard">
  		insert
		 into
		tbl_board
		(
			board_no	
		 ,	board_title
		 ,  board_content
		 ,	board_writer
		 ,	board_count
		 ,	board_regdate
		)
		values
		(
			#{board_no}
		,	#{board_title}
		,   #{board_content}
		,	#{board_writer}
		,	#{board_count}
		,	#{board_regdate}
		)
	</insert>
	
	

	<!-- 게시글 조회 -->
	<select id="BoardRead" parameterType="int" resultType="boardVO">
		select
		 *
		from 
		 tbl_board
		where board_no = #{board_no}
	
	</select>
	
	<!-- 게시글 수정 -->
	<update id="BoardUpdate" parameterType="boardVO">
		update tbl_board
			set board_title = #{board_title},	
				board_content = #{board_content}
		where board_no = #{board_no}
	</update>
	
	<!-- 게시글 삭제 -->
	<delete id="BoardDelete" parameterType="int">
		delete 
		  from tbl_board
		where board_no = #{board_no}
	</delete>

	<!-- 조회수 -->
	<update id="BoardHit" parameterType="int">
		update tbl_board set
		board_count = board_count+1
		where board_no = #{board_no}
	</update>
	
	
	<!-- 댓글 개수 -->
	<select id="ReadReply" resultType="replyVO">
		select 
		    a.board_no
		,   b.reply_no
		,   b.reply_writer
		,   b.reply_content
		,	b.reply_regdate 
		from soft.tbl_board a inner join soft.tbl_reply b 
		on a.board_no = b.board_no 
		where a.board_no = #{board_no};
	</select>

	<!-- 댓글 작성 -->
	<insert id="replyWrite">
		insert into tbl_board 
		(
			board_no
		   ,reply_no
		   ,reply_content
		   ,reply_writer
		) 
		values
		(
			#{board_no}
		   ,#{reply_no}
		   ,#{reply_content}
		   ,#{reply_writer}
		)   
	</insert>
	
	<insert id="insertFile">
		insert into tbl_file
		(
			file_no
		,	bno
		,	org_file_name
		,	stored_file_name
		,	regdate
		,	del_gb	
		)
		values
		(
			#{file_no}
		,	#{bno}
		,	#{org_file_name}
		,	#{stored_file_name}
		,	#{regdate}
		,	#{del_gb}
		
		)
	</insert>
	
	<!-- <select id="selectFileList" parameterType="int" resultType="hashMap">
		SELECT
			FILE_NO
		,	ORG_FILE_NAME
		,	ROUND(FILE_SIZE/1024,1) AS FILE_SIZE
		,FROM TBL_FILE
		WHERE BNO = #{bno}
		AND DEL_GB = 'N'
		ORDER BY FILE_NO ASC
	</select> -->
	
	<select id="selectFileInfo" parameterType="hashMap" resultType="hashMap">
		SELECT
			STORED_FILE_NAME
		,	ORG_FILE_NAME
		FROM TBL_FILE
		WHERE FILE_NO = #{FILE_NO}
	</select>
	
	<update id="updateFile" parameterType="hashMap">
		UPDATE TBL_FILE SET
		DEL_DB = 'Y'
		WHERE FILE_NO = #{FILE_NO}
	</update>
	
	<!-- <select id="movePage" parameterType="int" resultType="boardVO">
		select * from
	(select
		board_no,
		lead(board_no,1,board_no+1) OVER(order by board_no) as next,
		LAG(board_no,1,board_no-1) OVER(order by board_no) as last,
		board_title,
		LEAD(board_title,1,board_title) OVER(order by board_title) as nexttitle,
		LAG(board_title,1,board_title) over(order by board_title) as lasttitle
		from tbl_board
		where board_no = #{board_no}
		order by board_no desc
		)tbl_board
	</select> -->
	
	<select id="lastBoardList" parameterType="int" resultType="boardVO">
	 <![CDATA[
	SELECT 
		board_no
	,   board_title 
	FROM tbl_board 
		WHERE board_no < #{board_no}  
	ORDER BY board_no DESC LIMIT 1;
	]]>
	</select>
	
	<select id="nextBoardList" parameterType="int" resultType="boardVO">
	 <![CDATA[
	SELECT 
		board_no
	,   board_title 
	FROM tbl_board 
		WHERE board_no > #{board_no}  
	ORDER BY board_no DESC LIMIT 1;
	]]>
	</select>
	


</mapper>  